# Test que realiza un anÃ¡lisis de SonarQube en el cÃ³digo fuente del repositorio.
name: SonarQube Analysis
on:
  workflow_dispatch:

jobs:
  sonar:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run SonarQube analysis
        env:
          SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        run: |
          echo "ðŸ” Iniciando anÃ¡lisis de SonarQube..."
          echo "ðŸ“ Directorio actual: $(pwd)"
          echo "ðŸ“„ Archivos disponibles:"
          ls -la
          
          # Verificar que el archivo test.js existe
          if [ ! -f "test.js" ]; then
            echo "âŒ Error: El archivo test.js no se encontrÃ³"
            exit 1
          fi
          
          echo "âœ… Archivo test.js encontrado"
          
          # Crear archivo de configuraciÃ³n de SonarQube
          echo "ðŸ“ Creando archivo de configuraciÃ³n sonar-project.properties..."
          cat > sonar-project.properties << EOF
          sonar.projectKey=test-app-react-native
          sonar.projectName=Test App React Native
          sonar.projectVersion=1.0
          sonar.sources=test.js
          sonar.host.url=${{ secrets.SONAR_HOST_URL }}
          sonar.login=${{ secrets.SONAR_TOKEN }}
          sonar.sourceEncoding=UTF-8
          EOF
          
          echo "ðŸ“‹ Contenido del archivo de configuraciÃ³n:"
          cat sonar-project.properties
          
          echo "ðŸš€ Ejecutando anÃ¡lisis con SonarQube Scanner..."
          
          # Ejecutar anÃ¡lisis con SonarQube Scanner
          docker run --rm \
            -e SONAR_HOST_URL="${{ secrets.SONAR_HOST_URL }}" \
            -e SONAR_LOGIN="${{ secrets.SONAR_TOKEN }}" \
            -v "$PWD:/usr/src" \
            sonarsource/sonar-scanner-cli:latest \
            -Dsonar.projectKey=test-app-react-native \
            -Dsonar.sources=test.js \
            -Dsonar.host.url="${{ secrets.SONAR_HOST_URL }}" \
            -Dsonar.login="${{ secrets.SONAR_TOKEN }}" \
            -X
          
